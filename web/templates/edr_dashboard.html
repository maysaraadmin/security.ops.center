                                { id: 3, type: 'Failed Login', severity: 'medium', message: 'Multiple failed login attempts', agent: 'SERVER-01', time: '1 hour ago' },
                                { id: 4, type: 'Unusual Network Activity', severity: 'high', message: 'Suspicious outbound connection', agent: 'WORKSTATION-01', time: '2 hours ago' },
                                { id: 5, type: 'New Device', severity: 'info', message: 'New device connected to network', agent: 'Unknown', time: '3 hours ago' }
                            ];
                            
                            // Sample threats
                            threats = [
                                { name: 'Malware', severity: 'critical', count: 12, trend: 'up' },
                                { name: 'Brute Force', severity: 'high', count: 8, trend: 'up' },
                                { name: 'Suspicious Process', severity: 'high', count: 5, trend: 'same' },
                                { name: 'Unauthorized Access', severity: 'medium', count: 3, trend: 'down' },
                                { name: 'Data Exfiltration', severity: 'critical', count: 2, trend: 'up' }
                            ];
                            
                            updateDashboard();
                        }
                        
                        // Update dashboard with current data
                        function updateDashboard() {
                            // Update stats
                            totalAgentsEl.textContent = agents.length;
                            const onlineAgents = agents.filter(a => a.status === 'online').length;
                            onlineAgentsEl.textContent = onlineAgents;
                            onlineCountEl.textContent = onlineAgents;
                            offlineCountEl.textContent = agents.length - onlineAgents;
                            
                            // Update online percentage
                            const onlinePercent = Math.round((onlineAgents / agents.length) * 100);
                            onlineProgressEl.style.width = `${onlinePercent}%`;
                            onlineProgressEl.setAttribute('aria-valuenow', onlinePercent);
                            
                            // Update critical alerts
                            const criticalAlerts = alerts.filter(a => a.severity === 'critical').length;
                            criticalAlertsEl.textContent = criticalAlerts;
                            
                            // Update threats blocked
                            const threatsBlocked = threats.reduce((sum, t) => sum + t.count, 0);
                            threatsBlockedEl.textContent = threatsBlocked;
                            
                            // Update recent agents
                            updateRecentAgents();
                            
                            // Update recent alerts
                            updateRecentAlerts();
                            
                            // Update top threats
                            updateTopThreats();
                            
                            // Update agent activity
                            updateAgentActivity();
                        }
                        
                        // Update recent agents list
                        function updateRecentAgents() {
                            recentAgentsEl.innerHTML = '';
                            
                            // Sort by last seen (most recent first)
                            const sortedAgents = [...agents].sort((a, b) => {
                                return new Date(b.lastSeen) - new Date(a.lastSeen);
                            });
                            
                            // Show only the 5 most recent agents
                            sortedAgents.slice(0, 5).forEach(agent => {
                                const li = document.createElement('li');
                                li.className = `agent-item ${agent.status}`;
                                
                                const statusClass = agent.status === 'online' ? 'status-online' : 'status-offline';
                                const osIcon = agent.os.includes('Windows') ? 'windows' : 
                                             agent.os.includes('macOS') ? 'apple' : 'linux';
                                
                                li.innerHTML = `
                                    <div class="agent-avatar">
                                        <i class="fab fa-${osIcon}"></i>
                                    </div>
                                    <div class="agent-info">
                                        <div class="agent-name">${agent.name}</div>
                                        <div class="agent-status">
                                            <span class="status-indicator ${statusClass}"></span>
                                            ${agent.status.charAt(0).toUpperCase() + agent.status.slice(1)}
                                        </div>
                                    </div>
                                    ${agent.threats > 0 ? `<span class="alert-count">${agent.threats}</span>` : ''}
                                `;
                                
                                recentAgentsEl.appendChild(li);
                            });
                        }
                        
                        // Update recent alerts list
                        function updateRecentAlerts() {
                            recentAlertsEl.innerHTML = '';
                            
                            alerts.slice(0, 5).forEach(alert => {
                                const alertEl = document.createElement('a');
                                alertEl.href = '#';
                                alertEl.className = `list-group-item list-group-item-action ${alert.severity}-alert`;
                                
                                let icon = 'info-circle';
                                if (alert.severity === 'critical') icon = 'exclamation-triangle';
                                else if (alert.severity === 'high') icon = 'exclamation-circle';
                                else if (alert.severity === 'medium') icon = 'exclamation';
                                
                                alertEl.innerHTML = `
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">
                                            <i class="fas fa-${icon} me-2 text-${alert.severity === 'info' ? 'info' : 'danger'}"></i>
                                            ${alert.type}
                                        </h6>
                                        <small class="text-muted">${alert.time}</small>
                                    </div>
                                    <p class="mb-1">${alert.message}</p>
                                    <small class="text-muted">Agent: ${alert.agent}</small>
                                `;
                                
                                recentAlertsEl.appendChild(alertEl);
                            });
                        }
                        
                        // Update top threats table
                        function updateTopThreats() {
                            topThreatsEl.innerHTML = '';
                            
                            threats.forEach(threat => {
                                const tr = document.createElement('tr');
                                
                                let trendIcon = 'minus';
                                let trendClass = 'text-muted';
                                if (threat.trend === 'up') {
                                    trendIcon = 'arrow-up';
                                    trendClass = 'text-danger';
                                } else if (threat.trend === 'down') {
                                    trendIcon = 'arrow-down';
                                    trendClass = 'text-success';
                                }
                                
                                tr.innerHTML = `
                                    <td>${threat.name}</td>
                                    <td><span class="badge bg-${threat.severity}">${threat.severity.charAt(0).toUpperCase() + threat.severity.slice(1)}</span></td>
                                    <td>${threat.count}</td>
                                    <td><i class="fas fa-${trendIcon} ${trendClass}"></i></td>
                                `;
                                
                                topThreatsEl.appendChild(tr);
                            });
                        }
                        
                        // Update agent activity table
                        function updateAgentActivity() {
                            agentActivityEl.innerHTML = '';
                            
                            agents.forEach(agent => {
                                const tr = document.createElement('tr');
                                
                                const statusClass = agent.status === 'online' ? 'success' : 'secondary';
                                const statusText = agent.status === 'online' ? 'Online' : 'Offline';
                                
                                tr.innerHTML = `
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <span class="status-indicator status-${agent.status}"></span>
                                            <div class="ms-2">
                                                <div class="fw-bold">${agent.name}</div>
                                                <div class="text-muted small">${agent.ip}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-${statusClass}">${statusText}</span></td>
                                    <td>${agent.lastSeen}</td>
                                    <td>${agent.threats > 0 ? `<span class="badge bg-danger">${agent.threats} threats</span>` : '<span class="text-success">Clean</span>'}</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Details</button>
                                        <button class="btn btn-sm btn-outline-secondary">Scan</button>
                                    </td>
                                `;
                                
                                agentActivityEl.appendChild(tr);
                            });
                        }
                        
                        // Simulate system metrics updates
                        function updateSystemMetrics() {
                            // Update CPU usage
                            const cpuUsage = Math.min(100, Math.max(0, 30 + Math.random() * 40));
                            cpuUsageEl.textContent = `${cpuUsage.toFixed(1)}%`;
                            cpuBarEl.style.width = `${cpuUsage}%`;
                            cpuBarEl.setAttribute('aria-valuenow', cpuUsage);
                            
                            // Update memory usage
                            const memoryUsage = Math.min(100, Math.max(0, 40 + Math.random() * 50));
                            memoryUsageEl.textContent = `${memoryUsage.toFixed(1)}%`;
                            memoryBarEl.style.width = `${memoryUsage}%`;
                            memoryBarEl.setAttribute('aria-valuenow', memoryUsage);
                            
                            // Update disk usage
                            const diskUsage = Math.min(100, Math.max(0, 20 + Math.random() * 60));
                            diskUsageEl.textContent = `${diskUsage.toFixed(1)}%`;
                            diskBarEl.style.width = `${diskUsage}%`;
                            diskBarEl.setAttribute('aria-valuenow', diskUsage);
                            
                            // Update chart data
                            if (alertsChart) {
                                alertsChart.data.datasets.forEach(dataset => {
                                    const data = dataset.data;
                                    data.shift();
                                    data.push(Math.floor(Math.random() * (dataset.label === 'Critical' ? 10 : dataset.label === 'High' ? 15 : 20)));
                                });
                                alertsChart.update();
                            }
                            
                            // Randomly update agent status
                            if (Math.random() > 0.8) {
                                const randomAgent = agents[Math.floor(Math.random() * agents.length)];
                                const wasOnline = randomAgent.status === 'online';
                                randomAgent.status = wasOnline ? 'offline' : 'online';
                                randomAgent.lastSeen = 'Just now';
                                
                                if (wasOnline) {
                                    // Agent went offline
                                    const alert = {
                                        id: alerts.length + 1,
                                        type: 'Agent Offline',
                                        severity: 'high',
                                        message: `Agent ${randomAgent.name} is offline`,
                                        agent: randomAgent.name,
                                        time: 'Just now'
                                    };
                                    alerts.unshift(alert);
                                    
                                    // Notify via WebSocket
                                    if (socket) {
                                        socket.emit('alert', alert);
                                    }
                                } else {
                                    // Agent came online
                                    const alert = {
                                        id: alerts.length + 1,
                                        type: 'Agent Online',
                                        severity: 'info',
                                        message: `Agent ${randomAgent.name} is back online`,
                                        agent: randomAgent.name,
                                        time: 'Just now'
                                    };
                                    alerts.unshift(alert);
                                    
                                    // Notify via WebSocket
                                    if (socket) {
                                        socket.emit('alert', alert);
                                    }
                                }
                                
                                updateDashboard();
                            }
                        }
                        
                        // Set up WebSocket connection
                        function setupWebSocket() {
                            // Connect to the server
                            socket = io();
                            
                            // Handle connection
                            socket.on('connect', () => {
                                console.log('Connected to WebSocket server');
                            });
                            
                            // Handle disconnection
                            socket.on('disconnect', () => {
                                console.log('Disconnected from WebSocket server');
                            });
                            
                            // Handle new alert
                            socket.on('alert', (alert) => {
                                // Add alert to the beginning of the array
                                alerts.unshift(alert);
                                
                                // Update the dashboard
                                updateDashboard();
                                
                                // Show notification
                                showNotification(alert);
                            });
                            
                            // Handle agent status updates
                            socket.on('agent_update', (agent) => {
                                // Update agent status
                                const index = agents.findIndex(a => a.id === agent.id);
                                if (index !== -1) {
                                    agents[index] = { ...agents[index], ...agent };
                                    updateDashboard();
                                }
                            });
                        }
                        
                        // Show notification
                        function showNotification(alert) {
                            // Check if browser supports notifications
                            if (!('Notification' in window)) {
                                return;
                            }
                            
                            // Check if notification permission is already granted
                            if (Notification.permission === 'granted') {
                                createNotification(alert);
                            } 
                            // Otherwise, ask for permission
                            else if (Notification.permission !== 'denied') {
                                Notification.requestPermission().then(permission => {
                                    if (permission === 'granted') {
                                        createNotification(alert);
                                    }
                                });
                            }
                        }
                        
                        // Create a notification
                        function createNotification(alert) {
                            const notification = new Notification(`EDR Alert: ${alert.type}`, {
                                body: alert.message,
                                icon: '/static/favicon.ico'
                            });
                            
                            // Handle notification click
                            notification.onclick = function() {
                                window.focus();
                                // You can add logic to navigate to the alert details
                                console.log('Notification clicked', alert);
                            };
                        }
                        
                        // Initialize tooltips
                        document.addEventListener('DOMContentLoaded', function() {
                            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                            tooltipTriggerList.map(function (tooltipTriggerEl) {
                                return new bootstrap.Tooltip(tooltipTriggerEl);
                            });
                        });
                    </script>
                </body>
                </html>
