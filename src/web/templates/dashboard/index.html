{% extends "base.html" %}

{% block title %}Dashboard - EDR Security Center{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Dashboard</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
            <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
        </div>
        <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
            <i class="bi bi-calendar3"></i> This week
        </button>
    </div>
</div>

<div class="row">
    <!-- Alerts Summary -->
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-danger">
            <div class="card-body">
                <h5 class="card-title">Critical Alerts</h5>
                <h2 class="mb-0">12</h2>
                <div class="mt-2">
                    <span class="badge bg-light text-dark">+3 from yesterday</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <h5 class="card-title">Warnings</h5>
                <h2 class="mb-0">24</h2>
                <div class="mt-2">
                    <span class="badge bg-light text-dark">-2 from yesterday</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-info">
            <div class="card-body">
                <h5 class="card-title">Endpoints</h5>
                <h2 class="mb-0">5</h2>
                <div class="mt-2">
                    <span class="badge bg-light text-dark">2 online</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-white bg-success">
            <div class="card-body">
                <h5 class="card-title">Threats Blocked</h5>
                <h2 class="mb-0">147</h2>
                <div class="mt-2">
                    <span class="badge bg-light text-dark">+12 today</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Alert Activity -->
    <div class="col-md-8 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="card-title mb-0">Alert Activity</h5>
            </div>
            <div class="card-body">
                <canvas id="alertChart" height="300"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Recent Alerts -->
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Recent Alerts</h5>
                <a href="{{ url_for('dashboard.alerts') }}" class="btn btn-sm btn-outline-secondary">View All</a>
            </div>
            <div class="list-group list-group-flush">
                {% for i in range(5) %}
                <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Suspicious Process Detected</h6>
                        <small class="text-muted">2m ago</small>
                    </div>
                    <p class="mb-1">Process 'powershell.exe' with suspicious arguments detected</p>
                    <small class="text-danger">High Severity</small>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Endpoint Status -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Endpoint Status</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Hostname</th>
                                <th>IP Address</th>
                                <th>Status</th>
                                <th>Last Seen</th>
                                <th>Threats</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in range(3) %}
                            <tr>
                                <td>WS-{{ i+1 }}-EDR</td>
                                <td>192.168.1.{{ 100 + i }}</td>
                                <td><span class="badge bg-success">Online</span></td>
                                <td>Just now</td>
                                <td><span class="badge bg-danger">2</span></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary">Details</button>
                                </td>
                            </tr>
                            {% endfor %}
                            {% for i in range(2) %}
                            <tr class="table-secondary">
                                <td>WS-{{ i+4 }}-EDR</td>
                                <td>192.168.1.{{ 103 + i }}</td>
                                <td><span class="badge bg-secondary">Offline</span></td>
                                <td>2 hours ago</td>
                                <td><span class="badge bg-secondary">0</span></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>Details</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Alert Activity Chart
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('alertChart').getContext('2d');
        const alertChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Critical',
                    data: [12, 19, 3, 5, 2, 3, 8],
                    borderColor: 'rgb(220, 53, 69)',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    tension: 0.3,
                    fill: true
                }, {
                    label: 'Warning',
                    data: [8, 12, 5, 9, 12, 15, 10],
                    borderColor: 'rgb(255, 193, 7)',
                    backgroundColor: 'rgba(255, 193, 7, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 5
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}
